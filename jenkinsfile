pipeline{
    agent any
    environment{
        DOCKERHUB_CREDS = credentials('dockerhub')
        IMAGE_NAME = "mukesh1997/reactapp"
    stages{
        stage("git clone"){
            steps{
                git branch: 'main', url: "https://github.com/mukesh-cel/React-app.git"
            }
        }
        stage('build image'){
            steps{
                sh 'docker build -t $IMAGE_NAME:$BUILD_NUMBER .'
            }
        }
        stage('docker login'){
            steps{
                withCredentials([usernamePassword(credentialsId: 'dockerhub', usernameVariable: 'DOCKER_USER', passwordVariable: 'DOCKER_PASS')]) {
                    sh "echo \$DOCKER_PASS | docker login -u \$DOCKER_USER --password-stdin"
                }
            }
        }
        stage('push image'){
            steps{
                sh 'docker push $IMAGE_NAME:$BUILD_NUMBER'
            }
        }
        stage('remove image'){
            steps{
                sh 'docker rmi $IMAGE_NAME:$BUILD_NUMBER || true'
            }
        }
    }
}